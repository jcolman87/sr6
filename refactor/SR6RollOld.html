{{#unless (isRollType data.type "Initiative") }}
<h3>
	{{#unless (undefined data.actor)}}
	<img class="profile-img" src="{{data.actor.img}}" data-edit="img" title="{{actor.name}}" height="24" width="24" /> 
	{{/unless}}

	{{data.actor.name}}
	{{#unless (undefined data.type)}}
		<i style="font-size: 18px">- 
		{{#if (isRollType data.type "WeaponAttack") }}Attack
		{{else if (isRollType data.type "Attribute") }}Attribute 
		{{else if (isRollType data.type "Skill") }}Skill 
		{{else if (isRollType data.type "Defend") }}Defend 
		{{else if (isRollType data.type "SoakDamage") }}Soak Damage
		{{/if}}</i>
	{{/unless}}
</h3>
<header class="part-header flexrow chat-dice">
	<div>{{formula}}</div>
	<br/>
	<div class="resulttext" style="flex:2">
		<i style="font-weight: bold">{{hits}}</i> hits</div>
		
	<br/>
	{{#if critical_glitch}}
	<span style="color: rgb(215, 14, 233); flex:2">Critical Glitch!</span><br/>
	{{else glitch}}
	<span style="color: rgb(194, 76, 29); flex:2">Glitch!</span><br/>
	{{/if}}
</header>
{{#if (isRollType data.type "WeaponAttack") }}
<div>
	<i style="font-weight: bold">{{ distanceToString data.distance }}</i> distance 
	<i style="font-weight: bold">
	{{#if (eq data.firemode "SS") }}Single shot
	{{else if (eq data.firemode "SS") }}Semi Auto
	{{else if (eq data.firemode "BF") }}Burst Fire
	{{else if (eq data.firemode "FA") }}Full Auto
	{{/if}}</i>
	with <a class="chat-weapon" style="font-style: italic">{{data.weapon.name}}</a><br/>
	Damage: <i style="font-weight: bold">{{ data.damage }}</i><br/>
			Attack Rating: <i style="font-weight: bold">
			{{#if (eq data.distance 0 ) }} {{data.weapon.system.attack_ratings.close}}
			{{else if (eq data.distance 1) }} {{data.weapon.system.attack_ratings.near}}
			{{else if (eq data.distance 2) }} {{data.weapon.system.attack_ratings.medium}}
			{{else if (eq data.distance 3) }} {{data.weapon.system.attack_ratings.far}} 
			{{else if (eq data.distance 4) }} {{data.weapon.system.attack_ratings.extreme}}
			{{/if}}</i>
			<br/>
	<div class="chat-tooltip chat-weapon-collapsible" style="display: none">
	<section>
		<div>
			DV <i style="font-weight: bold">{{ data.weapon.system.damage}}</i><br/> 
			AR {{data.weapon.system.attack_ratings.close}} / 
			{{data.weapon.system.attack_ratings.near}} / 
			{{data.weapon.system.attack_ratings.medium}} / 
			{{data.weapon.system.attack_ratings.far}} / 
			{{data.weapon.system.attack_ratings.extreme}}
			<br/><div style="font-size: 10px">{{ data.weapon.system.description}}</div>
		</div>
	</section>
</div>
	<input class="chat-roll-button" id="roll-defense" data-attacker-id="{{data.actor._id}}" data-damage="{{ data.damage }}" data-weapon-id="{{data.weapon._id}}" data-hits="{{hits}}" type="button" value="Roll Defense"/>
</div>
{{/if}}

{{#if (isRollType data.type "Defend") }}
<div>
	{{#if (gt hits data.damage  )}}
	<i style="color: #006400">Defended Successfully</i>
	{{else}}
	<i style="font-style: italic; font-size: 10px"><i style="font-weight: bold; color: rgb(194, 76, 29);">{{ data.damage }}</i> damage</i>
	<br/>
	<input id="roll-soak" data-attacker-id="{{data.attacker._id}}" data-weapon-id="{{data.weapon._id}}" data-hits="{{hits}}" data-damage="{{ data.damage }}" type="button" value="Soak Damage"/>
	{{/if}}
</div>
{{/if}}

{{#if (isRollType data.type "SoakDamage") }}
<div>
	{{#if (gt hits data.damage  )}}
	<i style="color: #006400">No Damage taken</i>
	{{else}}
	{{ var "damage" (sub data.damage hits) }}
	Took <i style="font-size: 18px; color: rgb(194, 76, 29); font-weight: bold; ">{{damage}}</i> damage<br/>
	<i style="font-style: italic; font-size: 10px">DV({{ data.damage }}) - Hits({{ hits }}) = {{ damage }} damage</i>
	{{/if}}
</div>
{{/if}}

<div class="chat-tooltip chat-dice-collapsible" style="display: none">
	<section>
		<div>
			{{#each dice as |result id|}}
			<i class="roll {{result.classes}}" style="width: 24px; height: 24px;">&nbsp; </i>
			{{/each}}
		</div>
	</section>
</div>

{{ else }}
{{roll.total}}
{{/unless}}